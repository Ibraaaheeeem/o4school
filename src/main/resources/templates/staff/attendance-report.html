<th:block th:fragment="attendance-report-content">
    <style>
        .report-container {
            padding: 20px;
        }

        .report-header {
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .report-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
        }

        .report-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            color: #444;
        }

        .student-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .student-avatar-mini {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #f0f2f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #7f8c8d;
            font-size: 0.85rem;
            overflow: hidden;
        }

        .student-avatar-mini img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-present {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .badge-absent {
            background: #ffebee;
            color: #c62828;
        }

        .percentage-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .report-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .action-buttons {
                flex-direction: column;
                width: 100%;
                gap: 10px;
            }

            .view-selector {
                display: flex !important;
                width: 100%;
                margin-right: 0 !important;
            }

            .view-btn {
                flex: 1;
                text-align: center;
            }

            .action-btn {
                width: 100%;
                text-align: center;
            }

            .report-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
        }
    </style>

    <div class="report-container">
        <div class="report-header">
            <div>
                <h2 style="margin: 0;">Attendance Report</h2>
                <p style="margin: 5px 0 0 0; color: #7f8c8d;" th:if="${currentTerm}"
                    th:text="'Summary for ' + ${currentTerm.termName}"></p>
            </div>
            <div class="action-buttons">
                <div class="view-selector"
                    style="display: inline-flex; background: #f0f2f5; padding: 4px; border-radius: 8px; margin-right: 15px;">
                    <button class="view-btn active" onclick="switchReportView('summary', this)"
                        style="padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">Student
                        Summary</button>
                    <button class="view-btn" onclick="switchReportView('daily', this)"
                        style="padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; background: transparent; color: #666;">Daily
                        Breakdown</button>
                </div>
                <button class="action-btn secondary" onclick="window.print()">üñ®Ô∏è Print Report</button>
                <a href="javascript:void(0)" class="action-btn" style="background: #95a5a6; color: white;"
                    onclick="goBackToAttendanceTab()">Back</a>
            </div>
        </div>

        <div th:if="${studentStats == null || studentStats.isEmpty()}"
            style="text-align: center; padding: 50px; color: #999;">
            <p>No attendance data available for this term.</p>
        </div>

        <!-- Student Summary View -->
        <div id="summary-view">
            <table class="report-table" th:unless="${studentStats == null || studentStats.isEmpty()}">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Present</th>
                        <th>Absent</th>
                        <th>Total Days</th>
                        <th>Attendance %</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="entry : ${studentStats}">
                        <td>
                            <div class="student-info">
                                <div class="student-avatar-mini">
                                    <img th:if="${entry.key.passportPhotoUrl}" th:src="${entry.key.passportPhotoUrl}"
                                        th:alt="${entry.key.user.fullName}">
                                    <span th:unless="${entry.key.passportPhotoUrl}"
                                        th:text="${#strings.substring(entry.key.user.firstName, 0, 1)}">S</span>
                                </div>
                                <div>
                                    <div style="font-weight: 600;" th:text="${entry.key.user.fullName}">Name</div>
                                    <div style="font-size: 0.75rem; color: #7f8c8d;"
                                        th:text="${entry.key.admissionNumber}">ADM001</div>
                                </div>
                            </div>
                        </td>
                        <td><span class="badge badge-present" th:text="${entry.value.present}">0</span></td>
                        <td><span class="badge badge-absent" th:text="${entry.value.absent}">0</span></td>
                        <td th:text="${entry.value.total}">0</td>
                        <td>
                            <div class="percentage-circle"
                                th:style="'border-color: ' + (${entry.value.percentage >= 75} ? '#27ae60' : (${entry.value.percentage >= 50} ? '#f1c40f' : '#e74c3c'))"
                                th:text="${entry.value.percentage + '%'}">
                                0%
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Daily Breakdown View -->
        <div id="daily-view" style="display: none;">
            <div th:each="dateEntry : ${dailyBreakdown}" class="daily-group" style="margin-bottom: 30px;">
                <h3 style="background: #f8f9fa; padding: 10px 15px; border-left: 4px solid #3498db; margin-bottom: 10px;"
                    th:text="${#temporals.format(dateEntry.key, 'EEEE, dd MMMM yyyy')}">Date</h3>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Status</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="record : ${dateEntry.value}">
                            <td>
                                <div class="student-info">
                                    <div style="font-weight: 600;" th:text="${record.student.user.fullName}">Name</div>
                                    <div style="font-size: 0.75rem; color: #7f8c8d; margin-left: 10px;"
                                        th:text="'(' + ${record.student.admissionNumber} + ')'">ADM001</div>
                                </div>
                            </td>
                            <td>
                                <span class="badge"
                                    th:classappend="${record.status.name() == 'PRESENT' ? 'badge-present' : 'badge-absent'}"
                                    th:text="${record.status}">PRESENT</span>
                            </td>
                            <td th:text="${record.notes ?: '-'}">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        window.switchReportView = function (view, btn) {
            document.getElementById('summary-view').style.display = view === 'summary' ? 'block' : 'none';
            document.getElementById('daily-view').style.display = view === 'daily' ? 'block' : 'none';

            // Update buttons
            document.querySelectorAll('.view-btn').forEach(b => {
                b.classList.remove('active');
                b.style.background = 'transparent';
                b.style.color = '#666';
                b.style.boxShadow = 'none';
            });
            btn.classList.add('active');
            btn.style.background = 'white';
            btn.style.color = '#2c3e50';
            btn.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
        };

        window.goBackToAttendanceTab = function () {
            const activeClassItem = document.querySelector('.class-item.active');
            if (activeClassItem && typeof loadClassDetails === 'function') {
                loadClassDetails(activeClassItem);
                setTimeout(() => {
                    const attendanceTab = document.querySelector('[data-tab="attendance"]');
                    if (attendanceTab) attendanceTab.click();
                }, 500);
            }
        };
    </script>
</th:block>